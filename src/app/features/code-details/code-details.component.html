<div class="code-details-container panel-container">
    <!-- Page Header -->
    <div class="page-header">
        <div>
            <h2 class="main-content-title tx-24 mg-b-5">Code Details Configuration</h2>
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="javascript:void(0)">Details</a></li>
                <li class="breadcrumb-item active" aria-current="page">Code Details</li>
            </ol>
        </div>
    </div>

    <!-- Alert Messages -->
    <app-alert *ngIf="successMessage" type="success" [message]="successMessage"></app-alert>
    <app-alert *ngIf="errorMessage" type="error" [message]="errorMessage"></app-alert>

    <div class="content row row-sm">
        <!-- Form Column -->
        <div class="col-lg-12 col-md-12">
            <div class="card custom-card">
                <div class="card-body">
                    <h3 class="card-title">Add Detail Entry ({{ details.length }}/{{ attributeMainIds.length }})</h3>
                    <p class="card-description">Configure specific detail entries for this code.</p>

                    <form [formGroup]="detailForm" (ngSubmit)="onSubmit()">
                        <div class="row row-sm">
                            <div class="col-md-12 mb-3">
                                <label for="code" class="form-label">Code <span class="text-danger">*</span></label>
                                <input type="text" id="code" formControlName="code" class="form-control"
                                    [class.is-invalid]="code?.invalid && code?.touched"
                                    placeholder="Enter unique code (e.g. D1)">
                                <div *ngIf="code?.invalid && code?.touched" class="invalid-feedback">
                                    <span *ngIf="code?.errors?.['required']">Code is required.</span>
                                    <span *ngIf="code?.errors?.['minlength']">Minimum 2 characters.</span>
                                </div>
                            </div>
                        </div>

                        <div class="row row-sm mt-3">
                            <div class="col-md-6 mb-3">
                                <label for="nameAr" class="form-label">Name (Arabic)</label>
                                <input type="text" id="nameAr" formControlName="nameAr" class="form-control" dir="rtl"
                                    placeholder="الاسم بالعربية">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="nameEn" class="form-label">Name (English) <span
                                        class="text-danger">*</span></label>
                                <input type="text" id="nameEn" formControlName="nameEn" class="form-control"
                                    [class.is-invalid]="nameEn?.invalid && nameEn?.touched">
                            </div>
                        </div>

                        <div class="row row-sm mt-3">
                            <div class="col-md-6 mb-3">
                                <label for="descriptionAr" class="form-label">Description (Arabic)</label>
                                <textarea id="descriptionAr" formControlName="descriptionAr" class="form-control"
                                    rows="3" dir="rtl"></textarea>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="descriptionEn" class="form-label">Description (English)</label>
                                <textarea id="descriptionEn" formControlName="descriptionEn" class="form-control"
                                    rows="3"></textarea>
                            </div>
                        </div>

                        <div class="d-flex justify-content-end mt-4">
                            <button type="submit" class="btn btn-primary-save px-5"
                                [disabled]="detailForm.invalid || details.length >= attributeMainIds.length">
                                <i class="fa fa-plus-circle me-1"></i> Add Detail to List
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Details List Column -->
        <div class="col-lg-12 col-md-12 mt-4" *ngIf="details.length > 0">
            <div class="card custom-card">
                <div class="card-body">
                    <h3 class="card-title">Added Detail Entries ({{ details.length }}/{{ attributeMainIds.length }})
                    </h3>
                    <p class="card-description">Review entries before final save.</p>

                    <div class="attributes-items-container">
                        @for (detail of details; track $index) {
                        <div class="attribute-item">
                            <div class="attribute-header">
                                <h4>Detail Entry #{{ $index + 1 }}</h4>
                                <button type="button" class="btn btn-danger-delete btn-sm"
                                    (click)="removeDetail($index)" [disabled]="isLoading">
                                    ✕ Remove
                                </button>
                            </div>
                            <div class="attribute-details">
                                <div class="detail-row">
                                    <div class="detail-item w-100">
                                        <strong>Code</strong>
                                        <span>{{ detail.code }}</span>
                                    </div>
                                </div>
                                <div class="detail-row mt-3">
                                    <div class="detail-item">
                                        <strong>Name (AR)</strong>
                                        <span>{{ detail.nameAr }}</span>
                                    </div>
                                    <div class="detail-item">
                                        <strong>Name (EN)</strong>
                                        <span>{{ detail.nameEn }}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        }
                    </div>

                    <div class="d-flex justify-content-center mt-4">
                        <button type="button" class="btn btn-primary-save btn-lg px-5" (click)="saveAllDetails()"
                            [disabled]="isLoading || details.length !== attributeMainIds.length">
                            @if (isLoading) {
                            <span class="spinner-border spinner-border-sm me-1"></span>
                            Saving All Details...
                            } @else {
                            Save All & Continue <i class="fa fa-arrow-right ms-2"></i>
                            }
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>